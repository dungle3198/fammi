{"ast":null,"code":"var _jsxFileName = \"/Users/dungle/Desktop/fammi/src/components/Home.jsx\";\nimport React, { Component } from 'react';\nimport { docClient } from \"./Data/user\";\nimport { createFamily, joinFamily, family_list } from \"./Data/family\";\nimport { create_cometchat_user } from './Data/cometchatuser'; // import { ReactS3Client } from \"./Data/s3\";\n\nimport Navbar from \"./Navbar\";\nimport { Redirect } from 'react-router-dom';\nimport { v4 as uuidv4 } from 'uuid'; // For version 4\n\nimport $ from 'jquery';\n\nvar bcrypt = require(\"bcryptjs\");\n\nvar cookie = require(\"js-cookie\");\n\nexport default class Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      userlist: {},\n      email: \"\",\n      password: \"\",\n      key: \"\",\n      username: \"\",\n      avatar: \"\",\n      hasKey: false\n    };\n  }\n\n  checkUser() {\n    console.log(\"checking user\");\n    var email = cookie.get(\"email\"); //alert(email)\n\n    if (email !== undefined) {\n      return React.createElement(Redirect, {\n        to: \"/user\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 34\n        },\n        __self: this\n      });\n    }\n  }\n\n  handleFamilyKey(email) {\n    var fam = family_list.find(e => {\n      return e.family_key === this.state.key;\n    });\n\n    if (this.state.hasKey) {\n      if (fam !== undefined) {\n        fam.members.push(email);\n        joinFamily(this.state.key, fam.members);\n        this.setState({\n          email: \"\",\n          password: \"\",\n          key: \"\",\n          username: \"\",\n          avatar: \"\",\n          hasKey: false\n        });\n        return true;\n      }\n\n      alert(\"Invalid Family Key\");\n      return false;\n    } else {\n      if (fam === undefined) {\n        var members = [];\n        members.push(email);\n        createFamily(this.state.key, members);\n        return true;\n      }\n\n      alert(\"Existed Family Key\");\n      return false;\n    } //return false;\n    // if (fam === undefined) {\n    //     console.log(\"you created a family\");\n    //     var members = []\n    //     members.push(email);\n    //     createFamily(this.state.key, members)\n    //     return;\n    // } else {\n    //     console.log(\"you joined a family\");\n    //     fam.members.push(email)\n    //     joinFamily(this.state.key, fam.members);\n    //     return;\n    // }\n\n  }\n\n  keySelection(e) {\n    if (e.target.value === \"has\") {\n      console.log(\"you have a key already\");\n      this.setState({\n        hasKey: true\n      });\n    } else {\n      console.log(\"you dont have a key\");\n      this.setState({\n        hasKey: false\n      });\n    }\n  }\n\n  signUp(e) {\n    if (this.state.user_list.find(u => u.email === this.state.email) === undefined) {\n      function validateEmail(email) {\n        return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n      }\n\n      if (validateEmail(this.state.email) === true && this.handleFamilyKey()) {\n        var hashed = bcrypt.hashSync(this.state.password, 10); // hashing password\n\n        var commet_id = \"user\" + uuidv4();\n        this.createUser(this.state.email, hashed, this.state.key, this.state.username, \"\", commet_id); // then create it \n\n        create_cometchat_user(this.state.email, commet_id, \"https://unknown2020.s3-ap-southeast-1.amazonaws.com/ava.jpg\", this.state.key);\n        this.handleFamilyKey(this.state.email);\n        $('#signupModal').modal('hide');\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 105\n          },\n          __self: this\n        }); // if (document.getElementById(\"avatar\").files[0] === undefined) {\n        //     createUser(this.state.email, hashed, this.state.key, this.state.username, \"\", commet_id)// then create it \n        //     create_cometchat_user(this.state.email, commet_id, \"https://unknown2020.s3-ap-southeast-1.amazonaws.com/ava.jpg\", this.state.key)\n        //     this.handleFamilyKey(this.state.email)\n        //     return (<Redirect to={\"/\"} />)\n        // }\n        // var path = document.getElementById(\"avatar\").files[0].name; // get the image file name\n        // var filename = path.split('.')[0]; // get the name without the type\n        // ReactS3Client\n        //     .uploadFile(document.getElementById(\"avatar\").files[0], filename) // pload the image up to s3 first\n        //     .then(data => {\n        //         createUser(this.state.email, hashed, this.state.key, this.state.username, data.location, commet_id)// then create it \n        //         create_cometchat_user(this.state.email, commet_id, data.location, this.state.key)\n        //         this.handleFamilyKey(this.state.email)\n        //     })//create cometchat user\n        //     .then(alert(\"You have signed up successfully!\"))\n        //     .catch(err => console.error(err))\n        //createUser(this.state.email, hashed, this.state.key, this.state.username)\n        //setTimeout(e, 1000)\n        //alert(\"You have successfully signed up\")\n      }\n\n      return;\n    } else if (this.state.user_list.find(u => u.email === this.state.email) !== undefined) {\n      alert(\"This email address has been used for another account\");\n      return;\n    }\n\n    alert(\"Invalid email address\");\n  }\n\n  login(e) {\n    if (this.state.user_list.find(u => u.email === this.state.email) !== undefined) {\n      var user = this.state.user_list.find(u => u.email === this.state.email);\n\n      if (bcrypt.compareSync(this.state.password, user.password)) {\n        var check_box = document.getElementById(\"exampleCheck1\");\n\n        if (check_box) {\n          if (check_box.checked) {\n            cookie.set(\"email\", user.email); //alert(cookie.get(\"email\"))\n\n            cookie.set(\"username\", user.username);\n          } else {\n            cookie.set(\"email\", user.email, {\n              expires: 1 / 24\n            }); //alert(cookie.get(\"email\"))\n\n            cookie.set(\"username\", user.username, {\n              expires: 1 / 24\n            });\n          }\n        }\n\n        this.props.loginFunction(user);\n        alert(\"You have logged in successfully.\");\n        return;\n      }\n    }\n\n    alert(\"Incorrect email or password\");\n  }\n\n  handleAvatar() {\n    if (this.state.avatar !== \"\") {\n      return this.state.avatar;\n    }\n\n    return require('./imgs/ava.jpg');\n  }\n\n  displayAvatar() {\n    return React.createElement(\"img\", {\n      src: this.handleAvatar(),\n      alt: \"\",\n      width: \"150px\",\n      height: \"150px\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    });\n  }\n\n  handleChange(e) {\n    let obj = {};\n    obj[e.target.name] = e.target.value;\n    this.setState(obj); //console.log(user_list)\n  }\n\n  createUser(email, password, key, username, avatar, comet_id) {\n    var input = {\n      \"email\": email,\n      \"password\": password,\n      \"key\": key,\n      \"username\": username,\n      \"avatar\": avatar,\n      \"comet_uid\": comet_id\n    };\n    var params = {\n      TableName: \"users\",\n      Item: input\n    };\n    docClient.put(params, function (err, data) {\n      if (err) {\n        console.log(\"users::save::error - \" + JSON.stringify(err, null, 2));\n      } else {\n        console.log(\"users::save::success\");\n        this.getAllUsers();\n        alert(\"you have successfully signed up\");\n      }\n    }.bind(this));\n  }\n\n  getAllUsers() {\n    var params = {\n      TableName: \"users\"\n    };\n    docClient.scan(params, function (err, data) {\n      if (err) {\n        console.error(\"Unable to scan the table. Error JSON:\", JSON.stringify(err, null, 2));\n      } else {\n        //console.log(\"Scan succeeded.\");\n        var users = JSON.parse(JSON.stringify(data.Items));\n        this.setState({\n          user_list: users\n        });\n      }\n    }.bind(this));\n  }\n\n  componentDidMount() {\n    this.getAllUsers();\n  }\n\n  render() {\n    return React.createElement(React.Fragment, null, this.checkUser(), React.createElement(\"div\", {\n      className: \"Home bg-transparent\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(Navbar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"Background bg-white m-0 p-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"Smaller w-100 row border m-0 rounded\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-3 bg-white p-4 d-flex align-items-center rounded-left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      className: \"list-unstyled w-100\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(\"li\", {\n      className: \"lead pl-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, \"Post Story\"), React.createElement(\"li\", {\n      className: \"lead mt-2 pl-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }, \"Share Event\"), React.createElement(\"li\", {\n      className: \"lead mt-2 pl-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    }, \"Add to-do list\"), React.createElement(\"p\", {\n      className: \"text-center m-0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn btn-primary text-white mt-1\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#signupModal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, \"Sign up now\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn btn-outline-primary mt-1\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#loginModal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }, \"Or login.\")))), React.createElement(\"div\", {\n      className: \"col-9 p-0 rounded-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"Img rounded-right\",\n      src: require('./imgs/home.jpg'),\n      alt: \"\",\n      width: \"100%\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      className: \"modal fade\",\n      id: \"signupModal\",\n      tabIndex: -1,\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"modal-dialog\",\n      role: \"document\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"modal-content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"modal-header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: \"modal-title lead\",\n      id: \"exampleModalLabel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }, \"Signup\"), React.createElement(\"button\", {\n      type: \"button\",\n      className: \"close\",\n      \"data-dismiss\": \"modal\",\n      \"aria-label\": \"Close\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      \"aria-hidden\": \"true\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }, \"\\xD7\"))), React.createElement(\"div\", {\n      className: \"modal-body\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputEmail2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, \"Email address\"), React.createElement(\"input\", {\n      type: \"email\",\n      className: \"form-control\",\n      id: \"exampleInputEmail2\",\n      \"aria-describedby\": \"emailHelp\",\n      placeholder: \"Enter email\",\n      name: \"email\",\n      value: this.state.email,\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputUsername3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290\n      },\n      __self: this\n    }, \"Username\"), React.createElement(\"input\", {\n      type: \"text\",\n      className: \"form-control\",\n      id: \"exampleInputEmail3\",\n      placeholder: \"Enter username\",\n      name: \"username\",\n      value: this.state.username,\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputPassword1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, \"Password\"), React.createElement(\"input\", {\n      type: \"password\",\n      className: \"form-control\",\n      id: \"exampleInputPassword1\",\n      placeholder: \"Password\",\n      name: \"password\",\n      value: this.state.password,\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputPassword2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 310\n      },\n      __self: this\n    }, \"Comfirm Password\"), React.createElement(\"input\", {\n      type: \"password\",\n      className: \"form-control\",\n      id: \"exampleInputPassword2\",\n      placeholder: \"Password\",\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 311\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputEmail1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318\n      },\n      __self: this\n    }, \"Key\"), React.createElement(\"select\", {\n      className: \"form-control\",\n      id: \"exampleFormControlSelect1\",\n      onChange: this.keySelection.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319\n      },\n      __self: this\n    }, React.createElement(\"option\", {\n      value: \"not\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320\n      },\n      __self: this\n    }, \"Generate new key\"), React.createElement(\"option\", {\n      value: \"has\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321\n      },\n      __self: this\n    }, \"Already have key\")), React.createElement(\"input\", {\n      type: \"text\",\n      className: \"form-control mt-2\",\n      id: \"exampleInputKey1\",\n      placeholder: \"Enter key\",\n      name: \"key\",\n      value: this.state.key,\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323\n      },\n      __self: this\n    })), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"w-100 text-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn btn-primary w-75\",\n      onClick: this.signUp.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 333\n      },\n      __self: this\n    }, \"Signup\"))))))), React.createElement(\"div\", {\n      className: \"modal fade\",\n      id: \"loginModal\",\n      tabIndex: -1,\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"modal-dialog\",\n      role: \"document\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"modal-content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 346\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"modal-header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: \"modal-title lead\",\n      id: \"exampleModalLabel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348\n      },\n      __self: this\n    }, \"Login\"), React.createElement(\"button\", {\n      type: \"button\",\n      className: \"close\",\n      \"data-dismiss\": \"modal\",\n      \"aria-label\": \"Close\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      \"aria-hidden\": \"true\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350\n      },\n      __self: this\n    }, \"\\xD7\"))), React.createElement(\"div\", {\n      className: \"modal-body\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputEmail1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357\n      },\n      __self: this\n    }, \"Email address\"), React.createElement(\"input\", {\n      type: \"email\",\n      className: \"form-control\",\n      id: \"exampleInputEmail1\",\n      \"aria-describedby\": \"emailHelp\",\n      placeholder: \"Enter email\",\n      name: \"email\",\n      value: this.state.email,\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"exampleInputPassword3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368\n      },\n      __self: this\n    }, \"Password\"), React.createElement(\"input\", {\n      type: \"password\",\n      className: \"form-control\",\n      id: \"exampleInputPassword3\",\n      placeholder: \"Password\",\n      name: \"password\",\n      value: this.state.password,\n      onChange: this.handleChange.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"form-check\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"checkbox\",\n      className: \"form-check-input\",\n      id: \"exampleCheck1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      className: \"form-check-label\",\n      htmlFor: \"exampleCheck1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381\n      },\n      __self: this\n    }, \"Save password\")), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"w-100 text-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn btn-primary w-75\",\n      onClick: this.login.bind(this),\n      \"data-dismiss\": \"modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386\n      },\n      __self: this\n    }, \"Continue\")))))))));\n  }\n\n}","map":{"version":3,"sources":["/Users/dungle/Desktop/fammi/src/components/Home.jsx"],"names":["React","Component","docClient","createFamily","joinFamily","family_list","create_cometchat_user","Navbar","Redirect","v4","uuidv4","$","bcrypt","require","cookie","Home","constructor","props","state","userlist","email","password","key","username","avatar","hasKey","checkUser","console","log","get","undefined","handleFamilyKey","fam","find","e","family_key","members","push","setState","alert","keySelection","target","value","signUp","user_list","u","validateEmail","test","hashed","hashSync","commet_id","createUser","modal","login","user","compareSync","check_box","document","getElementById","checked","set","expires","loginFunction","handleAvatar","displayAvatar","handleChange","obj","name","comet_id","input","params","TableName","Item","put","err","data","JSON","stringify","getAllUsers","bind","scan","error","users","parse","Items","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { docClient } from \"./Data/user\";\nimport { createFamily, joinFamily, family_list } from \"./Data/family\";\nimport { create_cometchat_user } from './Data/cometchatuser'\n// import { ReactS3Client } from \"./Data/s3\";\nimport Navbar from \"./Navbar\";\nimport { Redirect } from 'react-router-dom';\nimport { v4 as uuidv4 } from 'uuid'; // For version 4\nimport $ from 'jquery';\nvar bcrypt = require(\"bcryptjs\");\nvar cookie = require(\"js-cookie\");\n\nexport default class Home extends Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n\n            userlist: {},\n            email: \"\",\n            password: \"\",\n            key: \"\",\n            username: \"\",\n            avatar: \"\",\n            hasKey: false\n        }\n        \n    }\n    checkUser() {\n        console.log(\"checking user\")\n        var email = cookie.get(\"email\");\n        //alert(email)\n        if (email !== undefined) {\n            return <Redirect to=\"/user\" />\n        }\n    }\n    handleFamilyKey(email) {\n        var fam = family_list.find((e) => { return e.family_key === this.state.key });\n        if (this.state.hasKey) {\n            if (fam !== undefined) {\n                fam.members.push(email)\n                joinFamily(this.state.key, fam.members);\n                this.setState({\n                    email: \"\",\n                    password: \"\",\n                    key: \"\",\n                    username: \"\",\n                    avatar: \"\",\n                    hasKey: false\n                })\n                \n                return true;\n\n            }\n            alert(\"Invalid Family Key\");\n            return false\n        }\n        else {\n            if (fam === undefined) {\n                var members = []\n                members.push(email);\n                createFamily(this.state.key, members)\n                return true;\n            }\n            alert(\"Existed Family Key\");\n            return false\n        }\n        //return false;\n        // if (fam === undefined) {\n        //     console.log(\"you created a family\");\n        //     var members = []\n        //     members.push(email);\n        //     createFamily(this.state.key, members)\n        //     return;\n        // } else {\n        //     console.log(\"you joined a family\");\n        //     fam.members.push(email)\n        //     joinFamily(this.state.key, fam.members);\n        //     return;\n        // }\n    }\n    keySelection(e) {\n        if (e.target.value === \"has\") {\n            console.log(\"you have a key already\");\n            this.setState({ hasKey: true })\n        }\n        else {\n            console.log(\"you dont have a key\");\n            this.setState({ hasKey: false })\n        }\n    }\n    signUp(e) {\n        if (this.state.user_list.find(u => u.email === this.state.email) === undefined) {\n            function validateEmail(email) {\n                return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)\n            }\n            if (validateEmail(this.state.email) === true && this.handleFamilyKey()) {\n                var hashed = bcrypt.hashSync(this.state.password, 10) // hashing password\n                var commet_id = \"user\" + uuidv4();\n\n                this.createUser(this.state.email, hashed, this.state.key, this.state.username, \"\", commet_id)// then create it \n                create_cometchat_user(this.state.email, commet_id, \"https://unknown2020.s3-ap-southeast-1.amazonaws.com/ava.jpg\", this.state.key)\n                this.handleFamilyKey(this.state.email)\n                $('#signupModal').modal('hide')\n                return (<Redirect to={\"/\"} />)\n                // if (document.getElementById(\"avatar\").files[0] === undefined) {\n                //     createUser(this.state.email, hashed, this.state.key, this.state.username, \"\", commet_id)// then create it \n                //     create_cometchat_user(this.state.email, commet_id, \"https://unknown2020.s3-ap-southeast-1.amazonaws.com/ava.jpg\", this.state.key)\n                //     this.handleFamilyKey(this.state.email)\n                //     return (<Redirect to={\"/\"} />)\n                // }\n                // var path = document.getElementById(\"avatar\").files[0].name; // get the image file name\n                // var filename = path.split('.')[0]; // get the name without the type\n\n                // ReactS3Client\n                //     .uploadFile(document.getElementById(\"avatar\").files[0], filename) // pload the image up to s3 first\n                //     .then(data => {\n                //         createUser(this.state.email, hashed, this.state.key, this.state.username, data.location, commet_id)// then create it \n                //         create_cometchat_user(this.state.email, commet_id, data.location, this.state.key)\n                //         this.handleFamilyKey(this.state.email)\n                //     })//create cometchat user\n                //     .then(alert(\"You have signed up successfully!\"))\n                //     .catch(err => console.error(err))\n\n\n                //createUser(this.state.email, hashed, this.state.key, this.state.username)\n                //setTimeout(e, 1000)\n                //alert(\"You have successfully signed up\")\n            }\n            return\n        }\n        else if (this.state.user_list.find(u => u.email === this.state.email) !== undefined) {\n            alert(\"This email address has been used for another account\")\n            return\n        }\n        alert(\"Invalid email address\")\n    }\n    login(e) {\n        if (this.state.user_list.find(u => u.email === this.state.email) !== undefined) {\n            var user = this.state.user_list.find(u => u.email === this.state.email)\n            if (bcrypt.compareSync(this.state.password, user.password)) {\n\n                var check_box = document.getElementById(\"exampleCheck1\")\n                if (check_box) {\n                    if (check_box.checked) {\n                        cookie.set(\"email\", user.email)\n                        //alert(cookie.get(\"email\"))\n                        cookie.set(\"username\", user.username)\n                    }\n                    else {\n                        cookie.set(\"email\", user.email, { expires: 1 / 24 })\n                        //alert(cookie.get(\"email\"))\n                        cookie.set(\"username\", user.username, { expires: 1 / 24 })\n                    }\n                }\n                this.props.loginFunction(user);\n                alert(\"You have logged in successfully.\")\n                return\n            }\n        }\n        alert(\"Incorrect email or password\")\n    }\n    handleAvatar() {\n        if (this.state.avatar !== \"\") {\n            return this.state.avatar;\n        }\n        return require('./imgs/ava.jpg');\n    }\n    displayAvatar() {\n        return <img src={this.handleAvatar()} alt=\"\" width=\"150px\" height=\"150px\" />\n    }\n    handleChange(e) {\n        let obj = {};\n        obj[e.target.name] = e.target.value;\n        this.setState(obj);\n        //console.log(user_list)\n    }\n    createUser (email, password, key, username,avatar,comet_id) {\n        var input = {\n            \"email\": email,\n            \"password\": password,\n            \"key\": key,\n            \"username\": username,\n            \"avatar\": avatar,\n            \"comet_uid\": comet_id\n        };\n        var params = {\n            TableName: \"users\",\n            Item: input\n        };\n        docClient.put(params, function (err, data) {\n    \n            if (err) {\n                console.log(\"users::save::error - \" + JSON.stringify(err, null, 2));\n            } else {\n                console.log(\"users::save::success\");\n                this.getAllUsers();\n                alert(\"you have successfully signed up\")\n            }\n        }.bind(this))\n        \n    }\n    getAllUsers (){\n        var params = {\n            TableName: \"users\"\n        };\n        \n        docClient.scan(params, function(err, data){\n            if (err) \n            {\n                console.error(\"Unable to scan the table. Error JSON:\", JSON.stringify(err, null, 2));\n            } \n            else {\n                //console.log(\"Scan succeeded.\");\n                var users = JSON.parse(JSON.stringify(data.Items))\n                this.setState({user_list:users})\n            }\n        }.bind(this));\n        \n    };\n    componentDidMount() {\n        this.getAllUsers();\n    }\n\n    render() {\n        return (\n            <>\n                {this.checkUser()}\n                <div className=\"Home bg-transparent\">\n                    <Navbar />\n\n                    {/* Jumbotron */}\n                    <div className=\"Background bg-white m-0 p-4\">\n                        <div className=\"Smaller w-100 row border m-0 rounded\">\n                            <div className=\"col-3 bg-white p-4 d-flex align-items-center rounded-left\">\n                                <ul className=\"list-unstyled w-100\">\n                                    <li className=\"lead pl-3\">Post Story</li>\n                                    <li className=\"lead mt-2 pl-3\">Share Event</li>\n                                    <li className=\"lead mt-2 pl-3\">Add to-do list</li>\n                                    <p className=\"text-center m-0\">\n                                        <br />\n                                        <button type=\"button\" className=\"btn btn-primary text-white mt-1\" data-toggle=\"modal\" data-target=\"#signupModal\">Sign up now</button>\n                                        <br />\n                                        <button type=\"button\" className=\"btn btn-outline-primary mt-1\" data-toggle=\"modal\" data-target=\"#loginModal\">Or login.</button>\n                                    </p>\n\n                                </ul>\n                            </div>\n                            <div className=\"col-9 p-0 rounded-right\">\n                                <img className=\"Img rounded-right\" src={require('./imgs/home.jpg')} alt=\"\" width=\"100%\" />\n                            </div>\n                        </div>\n                    </div>\n                    {/* Signup */}\n                    <div className=\"modal fade\" id=\"signupModal\" tabIndex={-1} role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                        <div className=\"modal-dialog\" role=\"document\">\n                            <div className=\"modal-content\">\n                                <div className=\"modal-header\">\n                                    <p className=\"modal-title lead\" id=\"exampleModalLabel\">Signup</p>\n                                    <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                        <span aria-hidden=\"true\">×</span>\n                                    </button>\n                                </div>\n                                <div className=\"modal-body\">\n                                    {/* Form */}\n                                    <form>\n                                        {/* <div className=\"form-group\">\n                                            <label htmlFor=\"name\">Avatar: </label>\n                                            <div>{this.displayAvatar()}</div>\n                                            <input type=\"file\"\n                                                className=\"form-control\"\n                                                id=\"avatar\"\n                                                name=\"avatar\"\n                                                value={this.state.avatar}\n                                                onChange={this.handleChange.bind(this)}\n                                            />\n                                        </div> */}\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputEmail2\">Email address</label>\n                                            <input type=\"email\"\n                                                className=\"form-control\"\n                                                id=\"exampleInputEmail2\"\n                                                aria-describedby=\"emailHelp\"\n                                                placeholder=\"Enter email\"\n                                                name=\"email\"\n                                                value={this.state.email}\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputUsername3\">Username</label>\n                                            <input type=\"text\"\n                                                className=\"form-control\"\n                                                id=\"exampleInputEmail3\"\n                                                placeholder=\"Enter username\"\n                                                name=\"username\"\n                                                value={this.state.username}\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputPassword1\">Password</label>\n                                            <input type=\"password\"\n                                                className=\"form-control\"\n                                                id=\"exampleInputPassword1\"\n                                                placeholder=\"Password\"\n                                                name=\"password\"\n                                                value={this.state.password}\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputPassword2\">Comfirm Password</label>\n                                            <input type=\"password\"\n                                                className=\"form-control\"\n                                                id=\"exampleInputPassword2\"\n                                                placeholder=\"Password\"\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputEmail1\">Key</label>\n                                            <select className=\"form-control\" id=\"exampleFormControlSelect1\" onChange = {this.keySelection.bind(this)}>\n                                                <option value ={\"not\"}>Generate new key</option>\n                                                <option value ={\"has\"}>Already have key</option>\n                                            </select>\n                                            <input type=\"text\"\n                                                className=\"form-control mt-2\"\n                                                id=\"exampleInputKey1\"\n                                                placeholder=\"Enter key\"\n                                                name=\"key\"\n                                                value={this.state.key}\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <br />\n                                        <div className=\"w-100 text-center\">\n                                            <button\n                                                type=\"button\"\n                                                className=\"btn btn-primary w-75\"\n                                                onClick={this.signUp.bind(this)}>Signup</button>\n                                        </div>\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    {/* Login */}\n                    <div className=\"modal fade\" id=\"loginModal\" tabIndex={-1} role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                        <div className=\"modal-dialog\" role=\"document\">\n                            <div className=\"modal-content\">\n                                <div className=\"modal-header\">\n                                    <p className=\"modal-title lead\" id=\"exampleModalLabel\">Login</p>\n                                    <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                        <span aria-hidden=\"true\">×</span>\n                                    </button>\n                                </div>\n                                <div className=\"modal-body\">\n                                    {/* Form */}\n                                    <form>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputEmail1\">Email address</label>\n                                            <input type=\"email\"\n                                                className=\"form-control\"\n                                                id=\"exampleInputEmail1\"\n                                                aria-describedby=\"emailHelp\"\n                                                placeholder=\"Enter email\"\n                                                name=\"email\"\n                                                value={this.state.email}\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"exampleInputPassword3\">Password</label>\n                                            <input type=\"password\"\n                                                className=\"form-control\"\n                                                id=\"exampleInputPassword3\"\n                                                placeholder=\"Password\"\n                                                name=\"password\"\n                                                value={this.state.password}\n                                                onChange={this.handleChange.bind(this)} />\n                                        </div>\n                                        <div className=\"form-check\">\n                                            <input type=\"checkbox\"\n                                                className=\"form-check-input\"\n                                                id=\"exampleCheck1\" />\n                                            <label className=\"form-check-label\" htmlFor=\"exampleCheck1\">Save password</label>\n                                        </div>\n                                        <br />\n                                        <div className=\"w-100 text-center\">\n\n                                            <button\n                                                type=\"button\"\n                                                className=\"btn btn-primary w-75\"\n                                                onClick={this.login.bind(this)}\n                                                data-dismiss=\"modal\">Continue</button>\n                                        </div>\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </>\n\n        )\n    }\n}\n"]},"metadata":{},"sourceType":"module"}